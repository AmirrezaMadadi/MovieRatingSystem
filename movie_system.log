2025-12-28 01:11:32,518 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-28 01:11:32,519 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='None'
2025-12-28 01:11:32,544 - app.services.movie_service - INFO - Successfully retrieved 4 movies out of 4
2025-12-28 01:11:32,545 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-28 01:15:36,495 - app.controller.movie_controller - INFO - Incoming GET request for movie details | movie_id: 4
2025-12-28 01:15:36,495 - app.services.movie_service - INFO - Detail request for movie_id: 4
2025-12-28 01:15:36,498 - app.services.movie_service - WARNING - Movie with id 4 not found in database
2025-12-29 12:07:39,391 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-29 12:09:20,244 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-29 12:09:20,244 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='None'
2025-12-29 12:09:20,309 - app.services.movie_service - INFO - Successfully retrieved 4 movies out of 4
2025-12-29 12:09:20,310 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-29 12:10:44,651 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=inception2, year=None, genre=None, page=1
2025-12-29 12:10:44,663 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='inception2'
2025-12-29 12:10:44,705 - app.services.movie_service - INFO - Successfully retrieved 1 movies out of 4
2025-12-29 12:10:44,706 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-29 12:10:49,948 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=inception1, year=None, genre=None, page=1
2025-12-29 12:10:49,949 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='inception1'
2025-12-29 12:10:49,951 - app.services.movie_service - INFO - Successfully retrieved 0 movies out of 4
2025-12-29 12:10:49,951 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-29 12:13:31,996 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=inception1, year=None, genre=None, page=1
2025-12-29 12:13:31,997 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='inception1'
2025-12-29 12:13:32,010 - app.services.movie_service - WARNING - No movies found matching filters: title=inception1, year=None, genre=None
2025-12-29 12:13:52,161 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-29 12:13:52,161 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='None'
2025-12-29 12:13:52,179 - app.services.movie_service - INFO - Successfully retrieved 4 movies
2025-12-29 12:13:52,179 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-29 12:13:59,687 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-29 12:13:59,707 - app.services.movie_service - INFO - Fetching movies: page=1, size=2, filter_title='None'
2025-12-29 12:13:59,711 - app.services.movie_service - INFO - Successfully retrieved 2 movies
2025-12-29 12:13:59,713 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-29 12:14:22,431 - app.controller.movie_controller - INFO - Incoming GET request for movie details | movie_id: 8
2025-12-29 12:14:22,431 - app.services.movie_service - INFO - Detail request for movie_id: 8
2025-12-29 12:14:22,436 - app.controller.movie_controller - INFO - Successfully retrieved details for movie_id: 8
2025-12-29 12:14:39,195 - app.controller.movie_controller - INFO - Incoming GET request for movie details | movie_id: 5
2025-12-29 12:14:39,207 - app.services.movie_service - INFO - Detail request for movie_id: 5
2025-12-29 12:14:39,245 - app.services.movie_service - WARNING - Movie with id 5 not found in database
2025-12-29 12:15:12,502 - app.controller.movie_controller - INFO - Incoming POST request to create movie: fkdlgfgk
2025-12-29 12:15:12,502 - app.services.movie_service - INFO - Attempting to create a new movie: fkdlgfgk
2025-12-29 12:15:12,503 - app.services.movie_service - ERROR - Failed to create movie: fkdlgfgk
Traceback (most recent call last):
  File "H:\CS Term_9\Software\MovieRatingSystem\app\services\movie_service.py", line 61, in create_new_movie
    new_movie = self.repo.create_movie(movie_data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: MovieRepository.create_movie() missing 1 required positional argument: 'genres'
2025-12-29 12:16:14,160 - app.controller.movie_controller - INFO - Incoming POST request to create movie: fkdlgfgk
2025-12-29 12:16:14,161 - app.services.movie_service - INFO - Attempting to create a new movie: fkdlgfgk
2025-12-29 12:16:14,161 - app.services.movie_service - ERROR - Failed to create movie: fkdlgfgk
Traceback (most recent call last):
  File "H:\CS Term_9\Software\MovieRatingSystem\app\services\movie_service.py", line 61, in create_new_movie
    new_movie = self.repo.create_movie(movie_data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: MovieRepository.create_movie() missing 1 required positional argument: 'genres'
2025-12-29 12:17:14,729 - app.controller.movie_controller - INFO - Incoming POST request to create movie: dfkglgf
2025-12-29 12:17:14,729 - app.services.movie_service - INFO - Attempting to create a new movie: dfkglgf
2025-12-29 12:17:14,730 - app.services.movie_service - ERROR - Failed to create movie: dfkglgf
Traceback (most recent call last):
  File "H:\CS Term_9\Software\MovieRatingSystem\app\services\movie_service.py", line 63, in create_new_movie
    new_movie = self.repo.create_movie(movie_data, genre_ids)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "H:\CS Term_9\Software\MovieRatingSystem\app\repositories\movie_repository.py", line 35, in create_movie
    db_movie = Movie(**movie_data)
               ^^^^^^^^^^^^^^^^^^^
TypeError: app.models.models.Movie() argument after ** must be a mapping, not MovieCreate
2025-12-29 12:18:31,163 - app.controller.movie_controller - INFO - Incoming POST request to create movie: sdsff
2025-12-29 12:18:31,163 - app.services.movie_service - INFO - Attempting to create a new movie: sdsff
2025-12-29 12:18:31,236 - app.services.movie_service - ERROR - Failed to create movie: sdsff
Traceback (most recent call last):
  File "H:\CS Term_9\Software\MovieRatingSystem\app\services\movie_service.py", line 66, in create_new_movie
    new_movie = self.repo.create_movie(movie_dict, genre_ids)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "H:\CS Term_9\Software\MovieRatingSystem\app\repositories\movie_repository.py", line 36, in create_movie
    db_movie.genres = genres
    ^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\attributes.py", line 540, in __set__
    self.impl.set(
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\attributes.py", line 1995, in set
    collections.bulk_replace(
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\collections.py", line 811, in bulk_replace
    appender(member, _sa_initiator=initiator)
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\collections.py", line 1138, in append
    item = __set(self, item, _sa_initiator, NO_KEY)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\collections.py", line 1103, in __set
    item = executor.fire_append_event(item, _sa_initiator, key=key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\collections.py", line 695, in fire_append_event
    return self.attr.fire_append_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\attributes.py", line 1762, in fire_append_event
    value = fn(state, value, initiator or self._append_token, key=key)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\attributes.py", line 2209, in emit_backref_from_collection_append_event
    child_state, child_dict = instance_state(child), instance_dict(child)
                              ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'int' object has no attribute '_sa_instance_state'
2025-12-29 12:20:34,392 - app.controller.movie_controller - INFO - Incoming POST request to create movie: ergkhflhf
2025-12-29 12:20:34,393 - app.services.movie_service - INFO - Attempting to create a new movie: ergkhflhf
2025-12-29 12:20:34,461 - app.services.movie_service - INFO - Movie created successfully with ID: 11
2025-12-29 12:20:34,461 - app.controller.movie_controller - INFO - New movie created successfully via API | ID: 11
2025-12-29 12:21:26,761 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-29 12:21:26,761 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='None'
2025-12-29 12:21:26,774 - app.services.movie_service - INFO - Successfully retrieved 5 movies
2025-12-29 12:21:26,777 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-29 12:23:57,218 - app.services.movie_service - INFO - Attempting to update movie_id 11 with new data
2025-12-29 12:23:57,219 - app.services.movie_service - ERROR - Critical error updating movie 11
Traceback (most recent call last):
  File "H:\CS Term_9\Software\MovieRatingSystem\app\services\movie_service.py", line 96, in update_existing_movie
    updated_movie = self.repo.update_movie(movie_id, movie_dict, genre_ids)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "H:\CS Term_9\Software\MovieRatingSystem\app\repositories\movie_repository.py", line 49, in update_movie
    setattr(movie, key, value)
AttributeError: 'int' object has no attribute 'title'
2025-12-29 12:28:04,742 - app.services.movie_service - INFO - Request to update movie_id: 11
2025-12-29 12:28:04,743 - app.services.movie_service - ERROR - Error updating movie 11: 'int' object has no attribute 'title'
Traceback (most recent call last):
  File "H:\CS Term_9\Software\MovieRatingSystem\app\services\movie_service.py", line 100, in update_existing_movie
    updated_movie = self.repo.update_movie(movie_id, movie_dict, genre_ids)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "H:\CS Term_9\Software\MovieRatingSystem\app\repositories\movie_repository.py", line 49, in update_movie
    setattr(movie, key, value)
AttributeError: 'int' object has no attribute 'title'
2025-12-29 12:28:52,832 - app.services.movie_service - INFO - Request to update movie_id: 11
2025-12-29 12:28:52,898 - app.services.movie_service - INFO - Movie_id 11 updated successfully
2025-12-29 12:29:04,964 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-29 12:29:04,965 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='None'
2025-12-29 12:29:04,972 - app.services.movie_service - INFO - Successfully retrieved 5 movies
2025-12-29 12:29:04,972 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-29 12:31:26,656 - app.services.movie_service - INFO - Request to delete movie_id: 11
2025-12-29 12:31:26,719 - app.services.movie_service - INFO - Movie_id 11 deleted successfully from database
2025-12-29 12:31:42,348 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-29 12:31:42,348 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='None'
2025-12-29 12:31:42,363 - app.services.movie_service - INFO - Successfully retrieved 4 movies
2025-12-29 12:31:42,364 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-29 12:32:01,292 - app.controller.movie_controller - INFO - Incoming POST request to rate movie_id 11 with score 8
2025-12-29 12:32:01,293 - app.services.movie_service - INFO - User adding rating 8 to movie_id 11
2025-12-29 12:32:01,299 - app.services.movie_service - ERROR - Error adding rating to movie 11
Traceback (most recent call last):
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.ForeignKeyViolation: insert or update on table "movie_ratings" violates foreign key constraint "movie_ratings_movie_id_fkey"
DETAIL:  Key (movie_id)=(11) is not present in table "movies".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "H:\CS Term_9\Software\MovieRatingSystem\app\services\movie_service.py", line 82, in add_rating_to_movie
    new_rating = self.repo.add_rating(movie_id, rating.score)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "H:\CS Term_9\Software\MovieRatingSystem\app\repositories\movie_repository.py", line 82, in add_rating
    self.db.commit()
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\amirr\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "movie_ratings" violates foreign key constraint "movie_ratings_movie_id_fkey"
DETAIL:  Key (movie_id)=(11) is not present in table "movies".

[SQL: INSERT INTO movie_ratings (score, movie_id) VALUES (%(score)s, %(movie_id)s) RETURNING movie_ratings.id]
[parameters: {'score': 8, 'movie_id': 11}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-12-29 12:32:49,207 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-29 12:32:49,207 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='None'
2025-12-29 12:32:49,214 - app.services.movie_service - INFO - Successfully retrieved 4 movies
2025-12-29 12:32:49,214 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
2025-12-29 12:32:59,072 - app.controller.movie_controller - INFO - Incoming POST request to rate movie_id 7 with score 8
2025-12-29 12:32:59,072 - app.services.movie_service - INFO - User adding rating 8 to movie_id 7
2025-12-29 12:32:59,108 - app.services.movie_service - INFO - Rating 8 saved for movie 7
2025-12-29 12:32:59,108 - app.controller.movie_controller - INFO - Rating submitted successfully for movie_id 7
2025-12-29 12:33:06,496 - app.controller.movie_controller - INFO - Incoming GET request to /movies | Filters: title=None, year=None, genre=None, page=1
2025-12-29 12:33:06,497 - app.services.movie_service - INFO - Fetching movies: page=1, size=10, filter_title='None'
2025-12-29 12:33:06,538 - app.services.movie_service - INFO - Successfully retrieved 4 movies
2025-12-29 12:33:06,538 - app.controller.movie_controller - INFO - Successfully returned movie list for page 1
